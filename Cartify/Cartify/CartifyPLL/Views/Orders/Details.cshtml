@model CartifyBLL.ViewModels.Orders.OrderDetailsVm

@{
    ViewData["Title"] = "Order Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="mb-4">Order Details</h2>

<div class="card p-3 mb-4 shadow-sm">
    <h4>Order #@Model.OrderId</h4>
    <p><strong>Date:</strong> @Model.OrderDate.ToString("dd MMM yyyy")</p>
    <p><strong>Status:</strong> <span class="badge bg-primary">@Model.OrderStatus</span></p>
    <p><strong>Total Amount:</strong> $@Model.TotalAmount.ToString("F2")</p>
    <p><strong>Shipping Method:</strong> @Model.ShippingMethod</p>
    <p><strong>Tracking Number:</strong> @(string.IsNullOrEmpty(Model.TrackingNumber) ? "N/A" : Model.TrackingNumber)</p>
</div>

<h5>Items in this order</h5>
<table class="table table-bordered table-striped">
    <thead class="table-light">
        <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Discount</th>
            <th>Subtotal</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.OrderItems)
        {
            <tr>
               
                <td>@item.Quantity</td>
                <td>$@item.Price.ToString("F2")</td>
                <td>$@item.Discount.ToString("F2")</td>
                <td>$@(item.Quantity * (item.Price - item.Discount)).ToString("F2")</td>
            </tr>
        }
    </tbody>
</table>

<div class="mt-3">
    <a href="@Url.Action("Index", "Orders")" class="btn btn-secondary">Back to Orders</a>
    @if (Model.OrderStatus == "Pending" || Model.OrderStatus == "Processing")
    {
        <button class="btn btn-danger" id="cancelBtn">Cancel Order</button>
    }
</div>

@section Scripts {
    <script>
        document.getElementById("cancelBtn")?.addEventListener("click", function () {
            if (confirm("Are you sure you want to cancel this order?")) {
                window.location.href = '@Url.Action("Cancel", "Orders", new { id = Model.OrderId })';
            }
        });
    </script>
}
