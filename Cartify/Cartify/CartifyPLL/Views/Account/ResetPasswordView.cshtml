@model CartifyBLL.ViewModels.Account.ResetPasswordVM
@{
    ViewData["Title"] = "Reset Password";
    ViewData["AuthTitle"] = "Reset Your Password";
    ViewData["AuthSubtitle"] = "Create a new password for your account";
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
}

<div class="auth-box shadow">
    <form asp-action="ResetPassword" method="post" id="resetPasswordForm" class="auth-form needs-validation" novalidate>
        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

        <input type="hidden" asp-for="Email" />

        <div class="form-floating mb-3 position-relative">
            <input asp-for="NewPassword" type="password" class="form-control" placeholder="New password" required minlength="8" />
            <i class="bi bi-lock position-absolute top-50 start-0 translate-middle-y ps-3 text-secondary"></i>
            <label asp-for="NewPassword">New Password</label>
            <span asp-validation-for="NewPassword" class="text-danger small"></span>
            <div class="invalid-feedback">Minimum 8 characters</div>
            <div class="password-strength mt-2">
                <div class="password-strength-bar"></div>
            </div>
        </div>

        <div class="form-floating mb-4 position-relative">
            <input asp-for="ConfirmNewPassword" type="password" class="form-control" placeholder="Confirm password" required />
            <i class="bi bi-lock position-absolute top-50 start-0 translate-middle-y ps-3 text-secondary"></i>
            <label asp-for="ConfirmNewPassword">Confirm New Password</label>
            <span asp-validation-for="ConfirmNewPassword" class="text-danger small"></span>
            <div class="invalid-feedback">Passwords must match</div>
        </div>

        <button type="submit" class="btn auth-btn auth-btn-primary w-100 mb-3">
            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            Reset Password
        </button>

        <div class="text-center small">
            Remember your password? <a asp-action="Login" class="text-decoration-none">Sign in</a>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Password strength indicator
            const passwordInput = document.getElementById('NewPassword');
            if (passwordInput) {
                const strengthBar = passwordInput.parentNode.querySelector('.password-strength-bar');
                
                passwordInput.addEventListener('input', function() {
                    const strength = calculatePasswordStrength(this.value);
                    strengthBar.style.width = strength.percentage + '%';
                    strengthBar.style.backgroundColor = strength.color;
                });
                
                function calculatePasswordStrength(password) {
                    let strength = 0;
                    
                    // Length (max 30 points)
                    strength += Math.min(password.length * 3, 30);
                    
                    // Contains numbers
                    if (/\d/.test(password)) strength += 10;
                    
                    // Contains both lower and upper case
                    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 20;
                    
                    const percentage = Math.min(Math.round(strength / 80 * 100), 100);
                    
                    return {
                        percentage: percentage,
                        color: percentage < 40 ? '#dc3545' : 
                               percentage < 70 ? '#fd7e14' : '#28a745'
                    };
                }
            }
            
            // Password match validation
            const confirmPassword = document.getElementById('ConfirmNewPassword');
            if (confirmPassword) {
                confirmPassword.addEventListener('input', function() {
                    const password = document.getElementById('NewPassword').value;
                    if (this.value !== password) {
                        this.setCustomValidity("Passwords must match");
                    } else {
                        this.setCustomValidity('');
                    }
                });
            }
            
            // Form submission handler
            const form = document.getElementById('resetPasswordForm');
            if (form) {
                form.addEventListener('submit', function() {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    const spinner = submitBtn.querySelector('.spinner-border');
                    submitBtn.disabled = true;
                    spinner.classList.remove('d-none');
                });
            }
        });
    </script>
}